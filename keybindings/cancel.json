[
  {
    "key": "escape",
    "command": "emacs-mcx.cancel",
    // ESC is used for other commands as well, so we need restrict the condition like this.
    // Ref: https://github.com/whitphx/vscode-emacs-mcx/issues/49
    // NOTE: Both `editorHasSelection` and `editorHasMultipleSelections` are needed because `editorHasSelection` doesn't include `editorHasMultipleSelections`
    // where `editorHasSelection` is false and `editorHasMultipleSelections` is true when there are multiple cursors and all are empty.
    "when": "!config.emacs-mcx.useMetaPrefixEscape && editorTextFocus && (editorHasSelection || editorHasMultipleSelections)"
  },
  {
    // When config.emacs-mcx.useMetaPrefixEscape is true where ESC is used as a Meta key,
    // assign `ESC ESC ESC` to `emacs-mcx.cancel`, which complements above `ESC` assignment.
    // NOTE: Original Emacs assigns `ESC ESC ESC` to `keyboard-escape-quit` that is different from `C-g`,
    // but we assign it to the same `cancel` command for now because we don't have needs to distinguish them.
    // Ref: https://www.gnu.org/software/emacs/manual/html_node/emacs/Quitting.html
    "key": "escape escape escape",
    "command": "emacs-mcx.cancel",
    "when": "config.emacs-mcx.useMetaPrefixEscape && editorTextFocus && (editorHasSelection || editorHasMultipleSelections)"
  },
  {
    "key": "ctrl+g",
    "command": "emacs-mcx.cancel",
    "when": "editorTextFocus"
  },
  {
    "key": "ctrl+g",
    "command": "emacs-mcx.isearchAbort",
    "when": "editorFocus && findInputFocussed && !isComposing"
  },
  {
    // `ESC ESC ESC` is bound to `isearch-abort` in original Emacs so we bind it here as well,
    // while it's enabled only when `config.emacs-mcx.useMetaPrefixEscape` is true so that
    // we leave the single `ESC` for normal cancel commands when `useMetaPrefixEscape` is false.
    "key": "escape escape escape",
    "command": "emacs-mcx.isearchAbort",
    "when": "config.emacs-mcx.useMetaPrefixEscape && editorFocus && findWidgetVisible && !isComposing"
  },
  {
    "key": "enter",
    "command": "emacs-mcx.isearchExit",
    "when": "editorFocus && findInputFocussed && !isComposing" // `!isComposing` is necessary to avoid closing the find widget when hitting `Enter` to confirm the IME input.
  },
  { "key": "ctrl+g", "command": "noop", "when": "sideBarFocus" },
  // Assign "C-g" to the commands which are assigned to "escape" by default.
  // Ref: https://github.com/whitphx/vscode-emacs-mcx/issues/1190
  {
    "$special": "cancelKeybindings"
  }
]
